- DeepResearchで生成した拡散確率モデルを確率微分方程式の観点から捉えることの利点
- 岡之原本第三章を読むにあたりSDEとして捉えることの嬉しさ・モチベーションを確認するために調査した
- 合わせてSongらの以下の論文も参照
    - SCORE-BASED GENERATIVE MODELING THROUGH STOCHASTIC DIFFERENTIAL EQUATIONS
    - https://arxiv.org/pdf/2011.13456
- SDEの観点でとらえることにより
    - サンプリング速度・品質改善
        - 例えば
    - 安定性の改善がされる
    - ノイズスケジューリングの最適化 


# サマリー

### 総括
拡散確率モデルをSDEの観点から捉えることにより、  
- 理論的な統一性と解析のしやすさが向上し、
- 高度な数値解法を適用することでサンプリング速度と安定性が大幅に改善され、
- 潜在空間での効率的な処理とノイズスケジュールの最適化が実現されるとともに、
- オープンな実装環境により、最新の研究成果が実運用サービス（例: Stable Diffusion）に迅速に反映される  
というメリットが得られています。これらの利点が、現代の高品質・高速な画像生成システムの基盤となっています。

以下は、**拡散確率モデルを確率微分方程式（SDE）の観点から捉えることの利点**を、構造的にまとめたサマリーです。

---

### 1. 理論的統一性の向上
- **連続時間モデルとしての定式化:**  
  従来の離散的なDDPMやスコアマッチング手法を、連続時間のSDEとして再定式化することで、順方向（ノイズ付加）と逆方向（ノイズ除去）のプロセスが統一的に理解できる。
- **Fokker–Planck方程式との対応:**  
  SDEにより、データ分布の時間発展を記述するFokker–Planck方程式と逆SDE（確率流ODE）の関係が明確になり、理論的な解析が容易になる。

---

### 2. サンプリングの高速化と安定性の向上
- **決定論的サンプリング（DDIMなど）の実現:**  
  確率流ODEに基づくサンプリングは、従来のランダム性を伴う逆拡散過程に比べ、少ないステップ数で高品質な生成を実現。
- **高次数値解法の応用:**  
  Euler法、Milstein法、あるいは多段法（PLMS、DPM-Solverなど）を活用することで、数値解法の安定性・収束性が保証され、短いステップ数での高速生成が可能になる。
- **予測子－修正子フレームワーク:**  
  予測段階と補正段階を組み合わせることで、局所的な数値誤差を補正し、全体の安定性と精度を向上させる。

---

### 3. 潜在空間での効率的生成
- **計算資源の大幅削減:**  
  ピクセル空間ではなく、低次元の潜在表現上でSDEを定義することで、計算コスト・メモリ使用量が劇的に削減される。
- **安定した数値解法の適用:**  
  潜在空間は高次元のピクセル空間に比べて状態のばらつきが小さいため、SDEソルバーの安定性が高く、より大きなステップ幅でも発散しにくい。

---

### 4. ノイズスケジュールの最適化
- **SDEに基づくノイズパラメータ設計:**  
  SDEの枠組みでは、時間依存の拡散係数（ノイズの注入量）を連続的な関数として最適化でき、各ステップでのノイズ除去の精度を高める。
- **時間刻みの調整:**  
  後半の微細な復元段階ではステップ幅を細かく、前半では大胆な進行を行うなど、適応的なスケジュール設計により生成品質と計算効率のトレードオフが最適化される。

---

### 5. 実装面での柔軟性と最新サービスへの応用
- **多様なサンプラーの実装:**  
  Hugging Face DiffusersライブラリやStable DiffusionのWeb UIでは、DDIM、PLMS、Euler、DPM-Solver、DPM++、UniPCなど、SDEの知見に基づく多様なサンプラーが提供され、用途に応じた選択が可能となっている。
- **オープンな実験環境:**  
  ユーザは実装上、パラメータやサンプラーを自由に切り替えながら実験できるため、SDEに基づく新たな手法の迅速な評価・改善が促進され、最新研究の成果が実用システムに素早く反映されている。

---



# 1. 拡散確率モデルを確率微分方程式の観点から捉えることの利点

拡散確率モデル（DDPMやScore-based Models）を確率微分方程式（SDE）の観点から捉えることの利点について調査します。

具体的には、
- SDEとしての定式化がどのようにDDPMやSBMの理解・応用を拡張するか
- SDEソルバー技術（数値解法、安定性解析など）を適用することで得られる知見
- 生成品質や計算効率への影響

といったポイントを整理し、専門家向けに詳細な説明資料を作成します。
調査結果をまとめたらお知らせします。

## SDEとしての定式化とその意義  
拡散モデル（DDPM）やスコアベース生成モデル（SBM）は、**確率微分方程式（SDE）**によって統一的に記述できます。まず**順方向のSDE**として、データ分布から徐々にノイズを加えていき、所定時間後に単純な事前分布（通常はガウス分布）へと連続的に移行させるプロセスを定義します ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=Abstract%3A%20Creating%20noise%20from%20data,SDE%20solvers%20to%20generate%20samples))。典型的には、時刻$t=0$でデータ$x_0$から出発し、$t=T$で標準正規分布に至るようにノイズを注入するSDEを設定します。この順拡散過程に対し、**逆方向のSDE（逆拡散過程）**を時間反転の理論に基づいて導出することで、ノイズからデータへ徐々に生成していくプロセスを得られます ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=Abstract%3A%20Creating%20noise%20from%20data,SDE%20solvers%20to%20generate%20samples))。特に重要なのは、**逆SDEのドリフト項（確定的な変化成分）が「スコア関数」**と呼ばれる値に依存することです ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=smoothly%20transforms%20a%20complex%20data,SDE%20solvers%20to%20generate%20samples)) ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=noise.%20Crucially%2C%20the%20reverse,SDE%20solvers%20to%20generate%20samples))。スコア関数とは各時刻の「摂動データ分布の対数密度勾配」$\nabla_x \log p_t(x)$のことであり、直感的には「現在の分布におけるデータ増加方向」を示すベクトル場です。逆SDEの定式化では、このスコア関数を用いてノイズを減衰させる方向のドリフトを与え、確率過程を逆転させます。  

SDEで表現する意義の一つは、**Fokker-Planck方程式**との対応づけです。順方向SDEに対しては、その確率密度$p_t(x)$の時間発展を記述するFokker-Planck方程式が存在し、ドリフト項と拡散項に応じた微分方程式で分布の変化が記述されます ([FokkerPlanck_Equation](http://www.peterholderrieth.com/blog/2023/The-Fokker-Planck-Equation-and-Diffusion-Models/#:~:text=Focker%20Planck%20Equation,as%20derivatives%20over%20coordinates%20%24x))。これにより、データ分布が時間とともにどのようにガウスノイズへ「拡散」していくかを解析的に捉えることができます。また時間反転した逆SDEは、対応する逆向きのFokker-Planck方程式（バックワードKolmogorov方程式）に従い、ガウス分布からデータ分布へ密度が遷移します。この逆過程のドリフトに現れる$\nabla_x \log p_t(x)$が先述の**スコア関数**であり、**スコアベースモデルではこの関数をニューラルネットで近似学習**します ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=smoothly%20transforms%20a%20complex%20data,SDE%20solvers%20to%20generate%20samples))。言い換えれば、モデルは各ノイズレベル$t$における「データの方向」を学習し、それを用いて逆SDEをシミュレーションすることでデータを生成します。  

SDEによる定式化は**DDPM（離散時間拡散モデル）とスコアマッチング手法**を一つの枠組みに統合する意義もあります。実際、Songらの研究 ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=We%20show%20that%20this%20framework,based%20models%2C%20as))により、従来のDDPM（Hoら, 2020）やスコアマッチング+ランジュバンダイナミクス（Song & Ermon, 2019）といった手法は、**連続時間SDEの離散化**と見なせることが示されました。この統一的理解によって、従来は別個に扱われていた手法が同等の理論基盤の上で比較・解析できるようになります ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=We%20show%20that%20this%20framework,based%20models%2C%20as))。例えば、DDPMでの逐次的な画像ノイズ除去ステップは、あるSDEをEuler-Maruyama法で離散時間シミュレーションしたものと解釈でき、一方でスコアマッチング＋ランジュバン法は同じSDEを小刻みなMCMCステップで解いているとみなせます。この観点の統一により、**連続時間モデルとしての拡散過程**を考えることで、理論解析の容易さや新たな手法の拡張につながりました ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=We%20show%20that%20this%20framework,based%20models%2C%20as))。また、**確率流（probability flow）ODE**との関係も明確になります。Fokker-Planck方程式を用いれば、拡散過程に対応する**確定的なODE（確率流ODE）**を導出でき、これを用いると「初期に一度ノイズをサンプリングするだけで、あとは決定論的に解を積分していく」という生成も可能になります ([FokkerPlanck_Equation](http://www.peterholderrieth.com/blog/2023/The-Fokker-Planck-Equation-and-Diffusion-Models/#:~:text=stochastic%20differential%20equations%20%28SDEs%29,models%20such%20as%20stable%20diffusion))。このODEを使ったサンプリング手法はStable Diffusionの実装などでも広く利用されており、生成時の乱数の影響を取り除いて**再現性や尤度計算を担保**できる利点があります ([FokkerPlanck_Equation](http://www.peterholderrieth.com/blog/2023/The-Fokker-Planck-Equation-and-Diffusion-Models/#:~:text=stochastic%20differential%20equations%20%28SDEs%29,models%20such%20as%20stable%20diffusion)) ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=predictor,99))。要するに、SDEによる定式化は拡散モデルの確率過程としての本質を捉え、**スコア関数を介した理論的理解**（順方向拡散と逆方向拡散の関係、PDEとの対応、ODEへの変換など）を可能にする点で意義深いです。

## SDEソルバー技術の適用による利点  
SDEとしてモデルを定式化すると、既存の**数値解法技術**を適用できるという大きな利点があります。SDEの数値解法としては、**Euler-Maruyama法**（オイラー・丸山法）や**Milstein法**、さらには**確率論的Runge-Kutta法**などが知られています。これらはそれぞれ数値積分の安定性や精度について理論的保証があり、拡散モデルのサンプリング過程にもその恩恵を与えます。例えば、Euler-Maruyama法は時間ステップを微小に取れば理論的に収束する基本的手法で、DDPMが用いている逐次的なノイズ除去はまさにこの方法に相当します。一方で、より高次の手法（Milstein法等）を用いれば離散化誤差を減らせるため、**同程度の生成品質をより少ないステップ数で実現**できる可能性があります。実際、古典的な数値解法には**安定性保証**があるため、SDEの枠組みに乗せることで生成過程の安定性向上が期待できます ([Score-Based Generative Modeling through Stochastic Differential Equations | TransferLab — appliedAI Institute ](https://transferlab.ai/pills/2022/score-based-generative-modelling-through-sde/#:~:text=,Kutta%20methods))。Songらの提案するフレームワークでも「広範な仮定の下で安定な古典的サンプリングアルゴリズム（Euler-Maruyamaや確率的Runge-Kutta）が利用可能になる」と述べられています ([Score-Based Generative Modeling through Stochastic Differential Equations | TransferLab — appliedAI Institute ](https://transferlab.ai/pills/2022/score-based-generative-modelling-through-sde/#:~:text=,Kutta%20methods))。これは、従来は経験的に調整されていたサンプリング手順に対し、数値解析分野で確立された手法を適用できることを意味します。  

**サンプリング速度の向上**も重要な利点です。拡散モデルは高品質なサンプルを得るには通常ステップ数（繰り返し回数）を多く必要とし、DDPMのオリジナル実装では1,000ステップ程度かけてノイズ除去を行っていました。SDEの枠組みでは、時間連続な理論モデルに対して**任意の時間ステップ幅で離散化**できるため、ステップ数を削減しつつ性能劣化を抑える工夫が可能です。例えば、高次のRunge-Kutta的手法や**予測子-修正子法（predictor-corrector）**を用いると、一歩あたりの進行を大きくしつつ誤差を補正できます ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=generative%20modeling%20and%20diffusion%20probabilistic,multiple%20architectural%20improvements%2C%20we%20achieve))。Songらは予測子-修正子フレームワークを導入し、まず大まかなステップで進み（予測子; 例: オイラー予測）、その後にランジュバン動力学による微調整（修正子）を行うことで、少ないステップでも精度良くサンプリングできることを示しました ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=generative%20modeling%20and%20diffusion%20probabilistic,multiple%20architectural%20improvements%2C%20we%20achieve))。このような工夫により、**サンプリングの高速化**が図れます。実際に近年の研究では、拡散モデルを35ステップ程度の解法で高品質にサンプリングすることに成功しています ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=This%20lets%20us%20identify%20several,training%20with%20our))（従来の何百ステップも必要だった手法に比べ大幅な高速化）。OpenAIやNVIDIAの研究でも、2次の安定な積分器（例えばHeun法）や学習された時間ステップ間隔を用いて、10～50ステップ程度での高速サンプリングを実現しています ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=This%20lets%20us%20identify%20several,training%20with%20our))。さらに**自適応ステップサイズ**のソルバーも検討されています。自動微分や局所誤差推定を用いて、必要な局面では細かく刻み、比較的容易な変化区間ではステップを大きく取るような手法（AdaDiff ([AdaDiff: Accelerating Diffusion Models through Step-Wise Adaptive ...](https://eccv.ecva.net/virtual/2024/poster/2161#:~:text=AdaDiff%3A%20Accelerating%20Diffusion%20Models%20through,to%20improve%20the%20generation))など）が提案されており、計算コストと精度のトレードオフを動的に最適化できます。これは将来的に**計算コストを抑えつつ安定性と精度を両立**する手段として有望です。  

もっとも、ステップ数を減らすことによる**品質面でのトレードオフ**も考慮が必要です。高次のODEソルバー（確率流ODEを数値積分する手法など）は大幅に高速化できる反面、元のSDEサンプル品質と比べるとわずかに分布の再現性で劣る場合が指摘されています ([NeurIPS Poster SEEDS: Exponential SDE Solvers for Fast High-Quality Sampling from Diffusion Models](https://neurips.cc/virtual/2023/poster/71474#:~:text=learntmodel%2C%20a%20process%20which%20has,of%20exactsolutions%20of%20diffusion%20SDEs))。言い換えれば、ランダム性を伴うゆっくりとしたサンプリング（SDEに忠実な方法）は理論上**真のデータ分布に収束**しますが、高速な決定論的サンプリングでは近似誤差によりサンプル品質（FIDなど）に差が出ることがあります ([NeurIPS Poster SEEDS: Exponential SDE Solvers for Fast High-Quality Sampling from Diffusion Models](https://neurips.cc/virtual/2023/poster/71474#:~:text=learntmodel%2C%20a%20process%20which%20has,of%20exactsolutions%20of%20diffusion%20SDEs))。しかし、このギャップを埋めるための研究も進んでおり、たとえば**SEEDS**という手法ではSDE解法自体を改良することで、従来の高速ODE手法並みの少ない反復で**品質の低下なく**サンプリングできることが報告されています ([NeurIPS Poster SEEDS: Exponential SDE Solvers for Fast High-Quality Sampling from Diffusion Models](https://neurips.cc/virtual/2023/poster/71474#:~:text=Inspired%20by%20the%20Exponential%20Time,strong%20convergence%20guarantees%20for%20them))。SEEDSは確率微分方程式の厳密解の一部を解析的に解き、高次の項まで扱う「指数時間積分法」を拡散モデルのSDEに応用することで、従来のSDEサンプリングより3～5倍高速に**最良性能（FID等）を維持したまま**サンプル生成できると示しています ([NeurIPS Poster SEEDS: Exponential SDE Solvers for Fast High-Quality Sampling from Diffusion Models](https://neurips.cc/virtual/2023/poster/71474#:~:text=Inspired%20by%20the%20Exponential%20Time,strong%20convergence%20guarantees%20for%20them))。このように、SDEソルバーの高度化により**サンプリング効率と安定性の大幅な向上**が期待でき、その選択肢と調整の自由度が得られる点がSDE視点の利点と言えます。総じて、確率微分方程式にもとづく数値計算の知見を活用することで、拡散モデルの**高速かつ安定なサンプリング**を実現しやすくなるのです。

## 生成品質や学習への影響  
SDEフレームワークの採用は**生成品質や学習プロセス**にもさまざまな影響を与えます。まず、モデルの学習において**スコア関数を直接学習**する枠組みは、確率密度の正規化項を必要としないという利点があります ([Diffusion and Score-Based Generative Models | The Center for Brains, Minds & Machines](https://cbmm.mit.edu/video/diffusion-and-score-based-generative-models#:~:text=to%20represent%20a%20probability%20distribution,generative%20modeling%20or%20diffusion%20modeling))。これは**確率的なスコアマッチング**に基づく手法で、複雑な確率分布を正規化定数を気にせず柔軟に近似できるため、GANのような従来手法に比べ安定した学習が可能です ([Diffusion and Score-Based Generative Models | The Center for Brains, Minds & Machines](https://cbmm.mit.edu/video/diffusion-and-score-based-generative-models#:~:text=to%20represent%20a%20probability%20distribution,generative%20modeling%20or%20diffusion%20modeling))。学習した時間依存のスコア関数を用いて逆SDEをシミュレートすることで、高品質なサンプルが得られることが実証されています。実際、Score-based SDEモデルはCIFAR-10やImagenetなどの画像生成で当時の最高性能を記録し、長らくGANが支配的だった分野で同等以上の品質を達成しました ([Diffusion and Score-Based Generative Models | The Center for Brains, Minds & Machines](https://cbmm.mit.edu/video/diffusion-and-score-based-generative-models#:~:text=resulting%20method%2C%20called%20score,tasks%20in%20medical%20image%20reconstruction))。例えばYang Songらのモデルでは、無条件CIFAR-10生成でInception Score 9.89・FID 2.20という当時の記録的性能を達成し、$1024^2$解像度の高精細画像生成にも世界で初めて成功しています ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=provide%20a%20new%20way%20to,based%20generative%20model))。この飛躍的な性能向上は、SDEフレームワークによって**時間的に連続な最適化**が可能になり、きめ細かいノイズスケジュールでモデルを訓練できたことが一因と考えられます。また、スコア関数の学習に際して**デノイジング誘導スコアマッチング**（DSM）の手法（Vincent, 2011に基づく）が用いられ、これにより各ノイズレベルでの最適な復元がモデル化されます。これはDDPMのオリジナル目的関数とも密接に関連しており、SDE視点ではそれらを統一的に理解できるため、**学習目標の設計**も洗練されました。例えば、重み付きDSMと変分下界を組み合わせたDDPMの目的 ([Score-Based Generative Modeling through Stochastic Differential Equations | TransferLab — appliedAI Institute ](https://transferlab.ai/pills/2022/score-based-generative-modelling-through-sde/#:~:text=Dec%202020))も、連続時間で見ればスコアマッチングの一種と解釈できます。このように、SDEフレームワークは**学習の安定性向上**や目的関数設計の体系化にも貢献しています。  

**生成過程の品質**という点では、SDEを用いることで**確率的サンプリング**と**決定論的サンプリング**の双方を活用できる柔軟性があります。逆SDEをそのまま数値解けば各ステップでノイズを注入しつつサンプルを生成する**確率的復元**となり、対応する**確率流ODE**を解けば途中のランダム性なしにノイズからデータへ写像する**決定論的復元**となります ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=predictor,99))。確率的復元ではランダム性によって多少のばらつきが生じますが、その分データ分布の多様性を忠実に再現できます。特に学習したスコアにわずかな偏りや誤差があっても、毎ステップ少量のノイズを加えることで微小な誤差を拡散し、結果的に真の分布に近いサンプルを得やすいという利点があります。一方、決定論的復元（ODEサンプリング）は一度初期ノイズを固定するとその後は完全に決まった経路を辿るため、**再現性**が高く**高速**でもあります ([FokkerPlanck_Equation](http://www.peterholderrieth.com/blog/2023/The-Fokker-Planck-Equation-and-Diffusion-Models/#:~:text=in%20diffusion%20models%20as%20an,models%20such%20as%20stable%20diffusion))。さらにこの経路は確率過程のマルジャン分布と一致するよう構成できるため、**同じ分布からサンプルを引く手段**として理論上同等です ([[2011.13456] Score-Based Generative Modeling through Stochastic Differential Equations](https://arxiv.org/abs/2011.13456#:~:text=discretized%20reverse,x%201024%20images%20for%20the))。Songらはこの確率流ODEを導入し、**サンプルの尤度を計算可能**（生成過程を明示的な確率モデルとして扱える）になることを示しました ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=predictor,99))。これは生成モデルの評価や学習において画期的で、実際に確率流ODEを用いることでピクセルベースの確率密度（bits per dim）の算出や明示的な対数尤度の最大化が可能となっています ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=predictor,99))。決定論的サンプリングはその過程が可逆であるため**厳密な対数尤度の評価**や**潜在変数としての解釈**が容易であり、拡散モデルを正規化フローの枠組みへつなげる役割も果たします。  

もっとも、実用上は確率的サンプリングと決定論的サンプリングで**生成物の特性に微妙な差異**が観察される場合もあります。例えば決定論的手法（DDIMや確率流ODE）はややシャープな画像を生成する傾向がありますが、繰り返しサンプリングしても同じ初期ノイズからは常に同じ結果になるため、**多様性の点で制限**があるとも言えます。一方、確率的な逆SDEサンプリングでは、同じ初期ノイズからでもランダム性によって異なる結果が得られうるため、**モードカバレッジ（分布の裾野まで含めた網羅性）**で有利な可能性があります。この違いは理論上は初期ノイズの分布で吸収されるものの、モデルスコアの近似誤差など実際の要因で生じると考えられます。最近の研究では、**確率的復元**と**決定論的復元**の中間を取るような手法も提案されています ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=shown%20to%20satisfy%20a%20first,minimization%20of%20these%20quadratic%20objectives))。たとえば**確率的補間（stochastic interpolants）**の枠組みでは、ノイズを加える強さを連続的に調整しながらサンプリングすることで、全くランダムなし（純粋なODE）からフルランダムなSDEまで連続的に橋渡しすることが可能です ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=shown%20to%20satisfy%20a%20first,minimization%20of%20these%20quadratic%20objectives))。これにより、再現性と多様性のバランスを制御しつつ生成品質を向上させる試みも行われています。総じて、SDEの視点を取り入れることで、**生成経路の設計自由度**が増し、モデルのもつ生成分布を高い忠実度で再現するための技法（予測子-修正子による誤差補正 ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=generative%20modeling%20and%20diffusion%20probabilistic,multiple%20architectural%20improvements%2C%20we%20achieve))やODEによる尤度計算 ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=predictor,99))など）が数多く生まれ、既存の拡散モデルと比べて**品質・多機能性が飛躍的に向上**しました。事実、最新のスコアベース拡散モデルはGANなど他手法を凌駕する高品質なサンプル生成を達成しており ([Diffusion and Score-Based Generative Models | The Center for Brains, Minds & Machines](https://cbmm.mit.edu/video/diffusion-and-score-based-generative-models#:~:text=resulting%20method%2C%20called%20score,tasks%20in%20medical%20image%20reconstruction))、この成功にはSDEフレームワークにもとづく精緻な生成過程制御が大きく寄与しています。

## 最先端研究の動向  
SDEの視点で拡散モデルを発展させた最新の研究も数多く登場しています。その一つが**EDM（Elucidating the Design Space of Diffusion Models）**と呼ばれるKarrasらの研究です ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=This%20lets%20us%20identify%20several,training%20with%20our))。彼らは連続時間拡散モデルの設計空間を体系的に整理し、**スコアネットワークの前処理（入力スケーリング）**や**学習・サンプリング手順の改善**などいくつかの設計変更を提案しました ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=models%20are%20currently%20unnecessarily%20convoluted,trained%20score))。この改良により、CIFAR-10のクラス条件付き生成でFID 1.79という当時の新たな最先端記録を達成し、非条件生成でもFID 1.97を実現しています ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=This%20lets%20us%20identify%20several,training%20with%20our))。注目すべきは、**サンプリングの高速化**も両立している点で、従来は数百ステップ必要だった生成を35ステップ程度のネットワーク評価で達成しています ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=This%20lets%20us%20identify%20several,training%20with%20our))。さらにEDMの枠組みはモジュール的で汎用性が高く、既存の事前学習済みスコアネットワークに適用するだけで品質・効率を大幅に改善できることも示されました ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=sampling%20,training%20with%20our))（例えば、従来のImageNet-64モデルのFIDを2.07から1.55に向上させ、提案手法で再学習すると1.36にまで改善）。これは、連続時間SDEモデルの**設計パラメータ（例えばノイズスケジュールやネットワークの正規化方法）**を最適化することで、性能を引き出せることを示しており、拡散モデルの設計論に大きな影響を与えました。  

別の興味深い発展として、**確率的補間（Stochastic Interpolants）**の枠組みが提案されています ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=,as%20a%20family%20of%20forward))。Albergoらの研究 ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=Authors%3AMichael%20S,Eijnden))では、**フロー（正常化フローなどの可逆変換モデル）と拡散（確率的拡散モデル）を統一的に包含する連続時間モデル**が導入されました。彼らの**確率的補間**モデルでは、任意の2つの確率分布を有限の時間で接続する**一連の確率過程**を構成します ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=,as%20a%20family%20of%20forward))。具体的には、始点と終点の分布からのデータを組み合わせ、補助的な潜在変数を用いることで中間の分布（インターポラント）を構築し、その時間発展を記述する一階の輸送方程式および拡散係数を調整可能なFokker-Planck方程式を導出します ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=Albergo%20%26%20Vanden,Upon))。この枠組みにより、**拡散モデルとフロー系モデルの中間的な生成モデル**が得られます。ノイズ項の強さを連続的に調節できるため、**確率流ODE（決定論的生成）から通常の拡散SDE（確率的生成）までを包含**し、ノイズのレベルを調整した新たな生成経路を定義できます ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=shown%20to%20satisfy%20a%20first,minimization%20of%20these%20quadratic%20objectives))。興味深いことに、このアプローチでは生成過程のドリフト項（速度場）が単純な2乗誤差目的（最適輸送的な目的関数）を最小化する解として求まり、そのうちの一つがインターポラント密度のスコアに対する新しい訓練目的となります ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=on%20probability%20flow%20equations%20or,deterministic%20dynamics%20is%20more%20stringent))。この方法で得られる生成モデルは**シュレーディンガーブリッジ**（Schrödinger Bridge：始点と終点の分布を与えて確率的に橋渡しする問題）の解を包含することも示されており、拡散モデルと確率的最適輸送の理論的な接点を提供しています ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=dynamics%2C%20while%20likelihood%20control%20for,two%20target%20densities%20when%20explicitly))。要するに、Stochastic Interpolantsは**生成モデルの設計空間を広げ、決定論的・確率的手法の両利点を取り込む統一的視点**として注目されています。  

さらに、他の最先端の研究例としては、前述の**SEEDS**による高速サンプリング技術の開発 ([NeurIPS Poster SEEDS: Exponential SDE Solvers for Fast High-Quality Sampling from Diffusion Models](https://neurips.cc/virtual/2023/poster/71474#:~:text=Inspired%20by%20the%20Exponential%20Time,strong%20convergence%20guarantees%20for%20them))や、**確率流のマッチング**（拡散過程を経由せずにデータとノイズ分布を結ぶ速度場を学習する手法）、**Schrödinger Bridgeを直接解くアプローチ**（拡散過程の尤度を最大化する別視点の訓練）などが挙げられます。これらはすべて、SDE的な拡散プロセスの理解を基盤として生まれた新手法であり、拡散モデルの効率や性能をさらに押し上げることに貢献しています。例えば、**確率流マッチング**では高次元分布間の最適な写像を直接学習し、従来の拡散過程よりも短い時間で生成を行う試みがあります。また、**適応的ステップ調整**の研究 ([Adaptive Time-Stepping Schedules for Diffusion Models | OpenReview](https://openreview.net/forum?id=lZzriJH2DC#:~:text=Adaptive%20Time,current%20practice%2C%20lacking%20theoretical%20foundations))では、どの時間点に学習・サンプリングのリソースを集中すべきかを理論的に検討し、時間ステップの非一様サンプリング戦略を提案しています。これにより、重要な時間帯（例えば画像生成で細部が現れる中間段階など）に計算を重点配分し、効率よくモデルの学習と生成を行えるようになります。  

このように、確率微分方程式の視点で拡散モデルをとらえることは、**理論的な統一と新技術の創出**という二面で大きな利点をもたらしました。定式化の統一により生まれた理解と技術（スコア関数の活用、逆SDE/ODE、古典解法の適用など）は、拡散モデルの性能を飛躍的に高め、画像生成のみならず音声や3次元点群、時系列データ生成など幅広い応用領域で最先端の結果を生み出しています ([Diffusion and Score-Based Generative Models | The Center for Brains, Minds & Machines](https://cbmm.mit.edu/video/diffusion-and-score-based-generative-models#:~:text=resulting%20method%2C%20called%20score,tasks%20in%20medical%20image%20reconstruction))。今後もSDEを基盤とした生成モデルの研究は進展し続けると予想され、例えば生成過程をより高速化しつつ理論保証もある手法や、制御可能性を高めた拡散プロセス（テキストや映像への条件付けを物理法則的に組み込むなど）への発展が期待されます。拡散確率モデルをSDEとして捉える視点は、これからも**生成モデル研究のフロンティア**として重要な役割を果たすでしょう。

**参考文献:** （質問内容に関連する論文や記事の引用） ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=Abstract%3A%20Creating%20noise%20from%20data,SDE%20solvers%20to%20generate%20samples)) ([Score-Based Generative Modeling through Stochastic Differential Equations | OpenReview](https://openreview.net/forum?id=PxTIG12RRHS#:~:text=noise.%20Crucially%2C%20the%20reverse,SDE%20solvers%20to%20generate%20samples)) ([FokkerPlanck_Equation](http://www.peterholderrieth.com/blog/2023/The-Fokker-Planck-Equation-and-Diffusion-Models/#:~:text=Focker%20Planck%20Equation,as%20derivatives%20over%20coordinates%20%24x)) ([Score-Based Generative Modeling through Stochastic Differential Equations | TransferLab — appliedAI Institute ](https://transferlab.ai/pills/2022/score-based-generative-modelling-through-sde/#:~:text=,Kutta%20methods)) ([[2206.00364] Elucidating the Design Space of Diffusion-Based Generative Models](https://arxiv.org/abs/2206.00364#:~:text=This%20lets%20us%20identify%20several,training%20with%20our)) ([[2303.08797] Stochastic Interpolants: A Unifying Framework for Flows and Diffusions](https://arxiv.org/abs/2303.08797#:~:text=shown%20to%20satisfy%20a%20first,minimization%20of%20these%20quadratic%20objectives))など.

# 2. SDEとの関係から生まれ、実際に利用されている技術例
了解しました。Stable Diffusionなどの最新サービスにおいて、SDEの知見が具体的にどのように応用されているかを詳しく調査します。

調査内容としては、
- **サンプリング技術の改良:** DDIMやPLMS、EulerサンプラーなどがSDEの知見をどのように活用しているか。
- **潜在空間拡散の最適化:** Stable DiffusionがどのようにSDEを利用して計算効率を向上させているか。
- **ノイズスケジュールの設計:** SDE視点でどのようにノイズスケジュールが最適化されているか。
- **その他の実装面:** Hugging Face DiffusersライブラリやStable Diffusion Web UIにおけるSDE技術の活用。

これらについて調査し、詳細な技術的説明をまとめます。結果がまとまり次第、お知らせします。

## 1. サンプリング技術の改良

**DDIMと確率微分方程式（SDE）の視点:**  DDIM（Denoising Diffusion Implicit Models）は、拡散モデルのサンプリングを高速化するために**確率過程を決定論的な微分方程式で近似する**手法です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=%2A%20Score,the%20alternative%20probability%20flow%20formulation)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=Denoising%20Diffusion%20Implicit%20Models%20,adding%20the%20following%20three%20components))。通常の拡散モデルでは、ノイズを徐々に除去する逆拡散過程はランダム性を伴いますが、Songら（2020）の研究により**「確率流（Probability Flow）ODE」**と呼ばれる決定論的な式で同じ分布変化を表現できることが示されました ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=,the%20alternative%20probability%20flow%20formulation))。DDIMはこの知見に基づき、**ランダムなノイズ項を省略しても最終分布が一致するように**逆拡散過程を再定式化しています。具体的には、各ステップで**最終的なクリーン画像と現在の画像との差分（方向ベクトル）**を予測されたノイズから推定し、そこに必要な微小ノイズ項を付加することで、元のSDEの軌道を暗黙的に近似します ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=Denoising%20Diffusion%20Implicit%20Models%20,adding%20the%20following%20three%20components))。このアプローチにより、DDIMは**ランダム性のない効率的なサンプリング**を実現し、従来の拡散モデルよりも**少ないステップ数で画像生成が可能**となりました ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=match%20at%20L352%20DDIM%20is,as%20few%20as%208%20steps))。例えば、DDIMは**8～15ステップ程度でも高品質な画像を生成できる**ことが報告されています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=match%20at%20L352%20DDIM%20is,as%20few%20as%208%20steps))。

**PLMSサンプラーとEulerサンプラーの最適化:**  PLMS（Pseudo Linear Multistep）は、**多段階の線形多段法によるODE解法を拡散サンプリングに応用した手法**です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=solvers%20thanks%20to%20the%20authors%E2%80%99,%E2%80%93%20The%20PLMS%20sampler))。Liuら（2022）のPNDM論文で提案され、**Runge–Kutta法や線形多段法といった数値解法を拡散モデルに適用**することで、サンプリング精度を向上させつつステップ数を削減しています ([Pseudo numerical methods for diffusion models (PNDM)](https://huggingface.co/docs/diffusers/v0.11.0/en/api/schedulers/pndm#:~:text=Pseudo%20numerical%20methods%20for%20diffusion,step%20method))。Stable Diffusionの初期実装（v1）にはDDIMとともにPLMSサンプラーが搭載されており、**DDIMより新しく高速な代替**と位置付けられました ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DDIM%20,and%20faster%20alternative%20to%20DDIM))。PLMSは過去数ステップ分の勾配（ノイズ予測値）を利用して次の状態を推定するため、**1ステップあたりの進み具合を大きくでき、収束を速める**利点があります ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=Much%20like%20Euler%E2%80%99s%20method%2C%20the,up%20to%204%20last%20values))。一方、**Eulerサンプラー**は古典的な**オイラー法**による単純な1段のODE解法を拡散過程に用いたもので、実装が容易で堅実な手法です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=Below%20is%20an%20example%20of,zero%20at%20the%20last%20step))。Karrasら（2022）の研究で示されたアルゴリズムに基づき、**20～30ステップ程度で良好な画像を生成できる高速サンプラー**として知られます ([EulerDiscreteScheduler](https://huggingface.co/docs/diffusers/main/en/api/schedulers/euler#:~:text=EulerDiscreteScheduler))。さらに**Euler **にランダム性を加えた**Euler Ancestral（Euler a）**も広く使われています。Euler aでは各ステップで一度予測よりも強めにノイズ除去を行いすぎてから、規定のノイズ量を追加し直すことで、**毎回異なる軌道をたどる拡散過程（祖先サンプル）**を実現します ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=Euler%20ancestral%20,were%20to%20do%20it%20again))。これにより**生成多様性が増す**反面、十分多くのステップをとっても**画像が一定の解像度に収束しない**（再現性が低い）という特徴があります ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=match%20at%20L189%20Images%20generated,images%20from%20Euler%20converge%20well))。総じて、PLMSやEulerサンプラーはいずれもSDEを**数値解法の観点から最適化**したもので、従来のランダムウォーク的なサンプルより**高速かつ安定して画像を得る**ことに寄与しました ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=,Karras%20and%20Heun)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=First%2C%20let%E2%80%99s%20look%20at%20the,DDIM))。

**最新のSDEベースのサンプラー:**  近年はさらに高次の数値解法を取り入れた**DPMソルバー系**のサンプラーが登場しています。Luら（2022）の**DPM-Solver**は拡散過程を表すODEを**2次・3次の高次精度で解く専用ソルバー**で、理論的な収束保証を持ちながら**およそ10ステップ程度で高品質なサンプル生成を可能にした**画期的手法です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=,%E2%80%93%20The%20DDIM%20sampler))。Stable Diffusionのコミュニティでも、DPM-Solverの2次版に相当する**DPM2**や、その改良版である**DPM++**が実装されています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DPM2%20is%20the%20DPM,up%20to%20the%20second%20order))。例えば、DPM++ 2M（2段の多段法）や2S（2段のシングルステップ法）などは安定かつ高速に収束し、**少ないステップ数でもDDIMやPLMSを凌ぐ品質**を達成しています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=match%20at%20L299%20DPM%2B%2B%202M,of%20steps%20is%20high%20enough)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DPM%2B%2B%20SDE%20and%20DPM%2B%2B%20SDE,best%20in%20this%20quality%20test))。特に**DPM++ SDE**と銘打たれたサンプラーは、各ステップにノイズを加える**確率的手法（祖先サンプル）**と高次解法を組み合わせることで**画質面で最良の結果**を示したと報告されています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=match%20at%20L367%20DPM%2B%2B%20SDE,best%20in%20this%20quality%20test))。ただしランダム性が入る分わずかに収束が遅れうるため、実用上は**DPM++ 2M Karras**（後述のKarrasスケジュール適用版）など**収束の速い手法**がデフォルト推奨されるケースもあります ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=match%20at%20L299%20DPM%2B%2B%202M,of%20steps%20is%20high%20enough)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=A%20lot%20of%20model%20developers,and%20the%20practice%20of%20many))。2023年には**UniPC**（Unified Predictor-Corrector）という新手法も登場し、予測子と補正子のステップを統合的に用いることで**5～10ステップでも極めて高い生成品質**を実現しています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=UniPC))。このように、最新の画像生成ではSDEに基づく数学的手法（数値解法や解の安定性理論）が積極的に取り入れられ、**サンプリングの高速化と高精度化**が飛躍的に進んでいます。

## 2. 潜在空間での拡散最適化

**潜在空間で拡散を行う利点:**  Stable Diffusionは**ピクセル空間ではなく潜在空間で拡散過程を定義**することで、大幅な効率化を実現したモデルです。元画像を事前に**訓練済みVAE（オートエンコーダ）で低次元の潜在ベクトルに圧縮**し、その潜在表現上でノイズ付加・除去の拡散モデルを適用します。これにより、例えば512×512×3画素（約78万次元）の画像生成を、64×64×4チャンネル（約1.6万次元）程度の**圧縮表現空間上で代替**でき、**メモリ使用量と計算量が劇的に削減**されます。潜在空間での生成は**データ分布の集中**にも寄与します。VAEによってエンコードされた潜在ベクトルは、ほぼ正規分布に近くスケーリングも調整されているため、**拡散モデルの前提とするガウス分布との整合性が高い**です。その結果、**学習の安定性が増し**、ピクセル空間で直接拡散する場合に比べて**モデルが収束しやすくなる**利点があります。確率微分方程式の視点から見ても、潜在空間で定義した拡散SDEは高次元ピクセル空間のSDEよりも**解の剛性が低く、数値的に扱いやすい**傾向があります。**状態空間が小さい分ノイズ除去のステップ幅を大きく取れる**ため、同じステップ数でもピクセル空間拡散より進行が早く、結果として高速化につながります。

**数値的安定性と計算コストへの貢献:**  潜在拡散モデルでは、SDEソルバー（数値解法）の適用においても**安定性と効率性のメリット**があります。まず、潜在ベクトル上の拡散過程は信号対雑音比が高く、中間状態でも**ピクセル空間ほど劇的に崩れたノイズ画像にならない**ため、**大きなステップ幅でも発散しにくい**傾向があります。これは**数値解法の安定条件**を緩和し、**高次のソルバーを安定に適用**しやすくします。実際、Stable Diffusionでは前述したDPM-Solver系やEuler法ベースの手法など、様々な高性能サンプラーを潜在空間上で問題なく動作させられます。計算コストの面でも、潜在空間での1ステップ計算は画素空間に比べて格段に軽量であるため、**高精度なSDEソルバーを用いても全体の計算負荷を低く抑えられる**利点があります。例えばHeun法（2階のオイラー法改良版）では各ステップで2回の予測が必要ですが、潜在空間拡散ならそのコストも許容範囲内となります ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=Heun))。総じて、Stable Diffusionは**潜在空間でのSDE定式化**によってモデルを小型化・単純化し、高度な数値解法の適用を可能にすることで、**計算効率と数値安定性の両立**を実現しています。

## 3. ノイズスケジュールの設計

**SDEの観点から見たノイズスケジュール:**  拡散モデルにおける**ノイズスケジュール**とは、時間ステップごとのノイズ量（あるいは逆拡散における除去ノイズ量）の推移を定める関数です。SDEの視点では、これは**時間変化する拡散係数**に相当し、連続時間拡散では**「どのようなSDEを定義するか」=「ノイズ強度の関数形をどう選ぶか」**という問題になります。Songらの確率微分方程式フレームワークでは、代表的なものとして**VP-SDE（分散保存型）**と**VE-SDE（分散増大型）**が提案されました。それぞれ離散時間での$\beta$スケジュール（ノイズ分散の増加曲線）に対応しており、例えばVP-SDEは**DDPMの線形ベータ増加**に相当し、VE-SDEは初期に微小ノイズから出発して徐々に分散を大きくする方式です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20samplers%20with%20the%20label,improves%20the%20quality%20of%20images)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20samplers%20with%20the%20label,you%20will%20see%20the%20noise))。ノイズスケジュールの選択は**生成品質と学習の安定性**に直結するため、様々な最適化研究がなされています。Nichol&Dhariwal (2021) は線形増加よりも**余弦関数に基づくスケジュール**の方が高いFID（画像生成評価指標）を達成できることを示し、$\beta$を時間に対して緩やかに立ち上げ最後に急増させる**Cosineスケジュール**を提案しました。このような工夫により、**早期ステップでは大きすぎるノイズ注入を避けて学習を安定化**し、後半ステップで微細なノイズを調整する時間を確保できます。さらにKarrasら（2022）は**生成段階における時間刻みの取り方**に着目し、**後半（低ノイズ領域）でステップ幅を細かくする離散化**を推奨しています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20samplers%20with%20the%20label,improves%20the%20quality%20of%20images))。いわゆる**「Karrasのノイズスケジュール」**では、逆拡散の後半ほど微小ステップで丁寧にノイズを除去する一方、前半（高ノイズ領域）では大胆にステップを進めます ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20samplers%20with%20the%20label,improves%20the%20quality%20of%20images))。この戦略により**詳細な部分の品質が向上**し、与えられたステップ数でより良い画像が得られることが報告されています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20samplers%20with%20the%20label,improves%20the%20quality%20of%20images))。

**ノイズスケジュール最適化の効果:**  ノイズスケジュールを最適化することで、**生成品質の向上と計算負荷の軽減の両面**に効果があります。適切なスケジュールの下では、各ステップが**画像の劣化を最小限に抑えつつ効率的にノイズを除去**するため、**必要なステップ数自体を減らす**ことが可能です。例えばKarrasらの手法を用いた**Karras版サンプラー**（例: *LMS Karras* や *DPM2 Karras*）は、デフォルトの線形スケジュールに比べて**少ないステップでも同等以上の画質**を達成します ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20samplers%20with%20the%20label,improves%20the%20quality%20of%20images)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DPM2%20is%20the%20DPM,up%20to%20the%20second%20order))。一方で、ステップ幅を不均一にするKarras方式は実装上**各ステップの演算量自体は変わらない**ため、総ステップ数が同じであれば計算コストも同程度です。ただし前述のDPM Fastのように**一様な粗いステップで高速化**を図る手法もあり、こちらは1階精度に落としてでもステップ数を半減させることで**実時間を短縮**しています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DPM%20Fast%20is%20a%20variant,twice%20as%20fast%20as%20DPM2))。これは極端な例ですが、要するに**ノイズスケジュールの設計次第で「速さと品質」のトレードオフを調整できる**わけです。最近では**適応的ステップ調整**（例: *DPM adaptive*）のように、画像の変化量に応じて**動的に次のステップ幅を決定するアルゴリズム**も登場しています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=accurate%20up%20to%20the%20first,twice%20as%20fast%20as%20DPM2))。これらは所定ステップ内に収まる保証と引き換えに最適なスケジュールを追求するアプローチで、計算負荷に制約がない場合には**常に必要最小のステップで収束可能**という利点があります。総じて、SDEの観点でノイズスケジュールを緻密に設計・最適化することは、**生成品質の向上（ノイズ除去の精緻化）**と**計算効率の改善（ステップ数削減）**の双方にもたらす重要な要素となっています。

## 4. その他の実装面での工夫

**Hugging Face DiffusersにおけるSDE知見の実装:**  Hugging Face社の提供する「Diffusers」ライブラリでは、最新の拡散モデル手法が柔軟に使えるよう**多数のサンプラー（スケジューラ）がクラス実装**されています ([EulerDiscreteScheduler](https://huggingface.co/docs/diffusers/main/en/api/schedulers/euler#:~:text=Schedulers))。例えば**EulerDiscreteScheduler**や**EulerAncestralDiscreteScheduler**として、前述のEuler法やEuler aサンプラーが実装されており、**20～30ステップで良好な出力を得られる高速手法**として紹介されています ([EulerDiscreteScheduler](https://huggingface.co/docs/diffusers/main/en/api/schedulers/euler#:~:text=EulerDiscreteScheduler)) ([EulerAncestralDiscreteScheduler](https://huggingface.co/docs/diffusers/en/api/schedulers/euler_ancestral#:~:text=EulerAncestralDiscreteScheduler))。また**LMSDiscreteScheduler**（線形多段法）、**HeunDiscreteScheduler**、**DPMSolverMultistepScheduler**、**DPMSolverSDEScheduler**等、**SDE/ODEソルバーに基づくあらゆる手法を網羅**しています ([EulerDiscreteScheduler](https://huggingface.co/docs/diffusers/main/en/api/schedulers/euler#:~:text=Schedulers))。Diffusersライブラリ利用者は**モデルとサンプラーを自由に組み合わせ**て拡散過程を制御できるため、研究知見に基づいた**新しいサンプル方式（例えばFlow MatchingやConsistencyモデルなど）**も差し替え可能です。 ([EulerDiscreteScheduler](https://huggingface.co/docs/diffusers/main/en/api/schedulers/euler#:~:text=The%20Euler%20scheduler%20,diffusion%20implementation%20by%20Katherine%20Crowson))実際、Karrasらの論文で提案された手法は**KarrasVeScheduler**や**KDPM2DiscreteScheduler**等として実装され、Crowson氏の*k-diffusion*実装にもとづき安定した動作を提供しています ([EulerDiscreteScheduler](https://huggingface.co/docs/diffusers/main/en/api/schedulers/euler#:~:text=EulerDiscreteScheduler))。このようにDiffusersでは、SDEの知見を反映した高度なサンプラー群を**プラグアンドプレイ形式で提供**しており、開発者は**数行のコードで最新手法を試せる**環境が整っています。

**Stable Diffusion Web UIでのSDE技術活用:**  Stable Diffusionの代表的なWeb UI（例: AUTOMATIC1111版）では、ユーザーが**サンプリング方法を直接選択**して画像生成できる機能が備わっています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=Many%20sampling%20methods%20are%20available,the%20answers%20in%20this%20article))。プルダウンメニューからDDIMやPLMSはもちろん、Euler、Euler a、LMS、Heun、DPM2、DPM++、そして最新のUniPCなど**十数種類におよぶサンプラー**を切り替え可能です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20repository%20implements%20the%20samplers,in%20the%20Karras%202022%20article))。これらの大半はCrowson氏の*k-diffusion*ライブラリ由来で、内部でSDE/ODEソルバーを実行する実装になっています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20repository%20implements%20the%20samplers,in%20the%20Karras%202022%20article))。ユーザーは目的に応じて**高速なサンプルが欲しければEuler aやDPM Fastを、安定して再現性の高い結果が欲しければEulerやDPM2系を、画質最優先ならDPM++ SDE Karrasを**といった具合に使い分けています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DPM%2B%2B%20SDE%20and%20DPM%2B%2B%20SDE,best%20in%20this%20quality%20test)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=match%20at%20L386%20,if%20you%20prefer%20stable%2C%20reproducible))。Web UI上でパラメータを変えるだけで**SDEに基づく高度な数値解法を試せる**ため、実験や調整が容易であり、コミュニティによるサンプラー評価も活発です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=First%2C%20let%E2%80%99s%20look%20at%20the,DDIM)) ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DPM%2B%2B%20fast%20failed%20pretty%20badly,that%20other%20samplers%20converged%20to))。このようなUIの柔軟性は、拡散モデルの性能を最大限に引き出す上で重要な要素となっており、専門知識を持つユーザーが**SDE理論にもとづく各種手法を実践的に活用できる環境**が整っています。

**既存モデルとの比較とSDE視点での改善点:**  Stable Diffusionが登場する以前の拡散モデルや他社の生成モデルと比べても、SDEの視点に立った様々な改良が見られます。まず**MidjourneyやDALL-E 2**といった最新の商用モデルも基本的には拡散ベース（もしくはそれに類する生成過程）と考えられますが、Stable Diffusionは**オープンソースである強み**を活かして研究コミュニティの知見を迅速に取り入れてきました。その最たる例が上述の**潜在拡散（Latent Diffusion）**というアーキテクチャで、OpenAIのDALL-E 2がピクセル空間での拡散や複数段のアップサンプリングを組み合わせていたのに対し、Stable Diffusionは**圧縮表現上で直接高解像度まで生成**することで計算資源あたりの性能を飛躍的に高めました。また**サンプリングアルゴリズムの多様さ**も大きな違いです。MidjourneyやDALL-Eのエンドユーザーは内部のサンプラーを選択できませんが、Stable Diffusionは前述の通りEulerやDPM++といった**最先端手法をユーザーが選び、わずかなステップで画像生成する**ことが可能です ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20repository%20implements%20the%20samplers,in%20the%20Karras%202022%20article))。これはすなわち、Stable Diffusionでは**研究段階のSDEソルバーを実運用に素早く反映**できるということであり、例えばOpenAIのGLIDEや初期の拡散モデルが数百ステップ必要だったところ、現在は数十ステップで同等以上の画質を達成できています ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=DDIM%20is%20doing%20surprisingly%20well,as%20few%20as%208%20steps))。さらに**ガイダンス手法との組み合わせ**にも改良が見られます。Stable Diffusionはテキスト条件の生成に分類器フリーガイダンスを用いていますが、高いガイダンス倍率は数値解法を不安定にしがちです。DPM-Solver++はまさに**ガイダンス付きサンプリングを安定化するために改良された手法**であり ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=%2A%20DPM,%E2%80%93%20The%20DDIM%20sampler))、これにより強力なテキスト誘導下でも破綻なく高速サンプリングが可能となっています。総合すると、Stable Diffusionは**従来モデルの弱点（高次元計算の重さ、サンプリングの遅さ、不安定さ）をSDE的発想で克服**したと言えます。他のモデルも追随して同様の工夫を凝らしていると考えられますが、公開情報の範囲ではStable Diffusionが**その先鞭をつけ、研究と実装の両面でSDEの知見を活かした改善をリード**している状況です。 ([Stable Diffusion Samplers: A Comprehensive Guide - Stable Diffusion Art](https://stable-diffusion-art.com/samplers/#:~:text=The%20samplers%20with%20the%20label,improves%20the%20quality%20of%20images))

